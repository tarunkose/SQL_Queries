-- This sql is user to convert one of column value as comma seprated value where reference column has duplicate values


--CREATE TABLE #TMP(
--NAME VARCHAR,
--VALUE INT
--)

--INSERT INTO #TMP VALUES ('A',1),('A',2),('A',3),('A',4)
--INSERT INTO #TMP VALUES ('B',1),('B',2),('B',3)
--INSERT INTO #TMP VALUES ('C',1),('C',2),('C',3)



DECLARE @NAME VARCHAR(5),
@VAL NVARCHAR(MAX) = ''

IF(OBJECT_ID('TEMPDB..#V') IS NOT NULL)
BEGIN
    DROP TABLE #V
END

IF(OBJECT_ID('TEMPDB..#NM') IS NOT NULL)
BEGIN
    DROP TABLE #NM
END


CREATE TABLE #V(
NAME VARCHAR,
VALUE NVARCHAR(MAX)
)

SELECT DISTINCT NAME INTO #NM FROM #TMP

SET @NAME = (SELECT TOP 1 NAME FROM #NM)

 WHILE @NAME IN (SELECT NAME FROM #NM)
	 BEGIN
			SELECT @VAL= @VAL + CAST(VALUE AS VARCHAR) + ','--CONCAT(CAST(VALUE AS VARCHAR), ',') 
			FROM #TMP T
			WHERE NAME =@NAME

			INSERT INTO  #V 
			SELECT  @NAME, LEFT(@VAL, LEN(@VAL)-1) 

			DELETE FROM #NM WHERE NAME=@NAME

			SET @NAME = (SELECT TOP 1 NAME FROM #NM)
			SET @VAL = ''
	END 

SELECT * FROM #V
